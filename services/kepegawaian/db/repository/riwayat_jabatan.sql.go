// Code generated by sqlc. DO NOT EDIT.
// source: riwayat_jabatan.sql

package repository

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countRiwayatJabatan = `-- name: CountRiwayatJabatan :one
SELECT count(1)
FROM riwayat_jabatan
WHERE riwayat_jabatan.pns_nip = $1::varchar and riwayat_jabatan.deleted_at IS NULL
`

func (q *Queries) CountRiwayatJabatan(ctx context.Context, pnsNip string) (int64, error) {
	row := q.db.QueryRow(ctx, countRiwayatJabatan, pnsNip)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const getBerkasRiwayatJabatan = `-- name: GetBerkasRiwayatJabatan :one
select file_base64 from riwayat_jabatan
where pns_nip = $1 and id = $2 and deleted_at is null
`

type GetBerkasRiwayatJabatanParams struct {
	PnsNip pgtype.Text `db:"pns_nip"`
	ID     int64       `db:"id"`
}

func (q *Queries) GetBerkasRiwayatJabatan(ctx context.Context, arg GetBerkasRiwayatJabatanParams) (pgtype.Text, error) {
	row := q.db.QueryRow(ctx, getBerkasRiwayatJabatan, arg.PnsNip, arg.ID)
	var file_base64 pgtype.Text
	err := row.Scan(&file_base64)
	return file_base64, err
}

const listRiwayatJabatan = `-- name: ListRiwayatJabatan :many
SELECT
    riwayat_jabatan.id,
    ref_jenis_jabatan.nama as jenis_jabatan,
    riwayat_jabatan.jabatan_id as id_jabatan,
    ref_jabatan.nama_jabatan,
    tmt_jabatan,
    no_sk,
    tanggal_sk,
    ref_unit_kerja.nama_unor as satuan_kerja,
    status_plt,
    ref_kelas_jabatan.kelas_jabatan,
    periode_jabatan_start_date,
    periode_jabatan_end_date,
    unit_organisasi.nama_unor as unit_organisasi
FROM riwayat_jabatan
LEFT JOIN ref_unit_kerja on riwayat_jabatan.satuan_kerja_id = ref_unit_kerja.id AND ref_unit_kerja.deleted_at IS NULL
LEFT JOIN ref_kelas_jabatan on riwayat_jabatan.kelas_jabatan_id = ref_kelas_jabatan.id AND ref_kelas_jabatan.deleted_at IS NULL
LEFT JOIN ref_unit_kerja unit_organisasi on riwayat_jabatan.unor_id = unit_organisasi.id AND unit_organisasi.deleted_at IS NULL
LEFT JOIN ref_jenis_jabatan on riwayat_jabatan.jenis_jabatan_id = ref_jenis_jabatan.id AND ref_jenis_jabatan.deleted_at IS NULL
LEFT JOIN ref_jabatan on riwayat_jabatan.jabatan_id = ref_jabatan.kode_jabatan AND ref_jabatan.deleted_at IS NULL
WHERE riwayat_jabatan.pns_nip = $3::varchar and riwayat_jabatan.deleted_at IS NULL
ORDER BY tmt_jabatan DESC
LIMIT $1 OFFSET $2
`

type ListRiwayatJabatanParams struct {
	Limit  int32  `db:"limit"`
	Offset int32  `db:"offset"`
	PnsNip string `db:"pns_nip"`
}

type ListRiwayatJabatanRow struct {
	ID                      int64       `db:"id"`
	JenisJabatan            pgtype.Text `db:"jenis_jabatan"`
	IDJabatan               pgtype.Text `db:"id_jabatan"`
	NamaJabatan             pgtype.Text `db:"nama_jabatan"`
	TmtJabatan              pgtype.Date `db:"tmt_jabatan"`
	NoSk                    pgtype.Text `db:"no_sk"`
	TanggalSk               pgtype.Date `db:"tanggal_sk"`
	SatuanKerja             pgtype.Text `db:"satuan_kerja"`
	StatusPlt               pgtype.Bool `db:"status_plt"`
	KelasJabatan            pgtype.Text `db:"kelas_jabatan"`
	PeriodeJabatanStartDate pgtype.Date `db:"periode_jabatan_start_date"`
	PeriodeJabatanEndDate   pgtype.Date `db:"periode_jabatan_end_date"`
	UnitOrganisasi          pgtype.Text `db:"unit_organisasi"`
}

func (q *Queries) ListRiwayatJabatan(ctx context.Context, arg ListRiwayatJabatanParams) ([]ListRiwayatJabatanRow, error) {
	rows, err := q.db.Query(ctx, listRiwayatJabatan, arg.Limit, arg.Offset, arg.PnsNip)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListRiwayatJabatanRow
	for rows.Next() {
		var i ListRiwayatJabatanRow
		if err := rows.Scan(
			&i.ID,
			&i.JenisJabatan,
			&i.IDJabatan,
			&i.NamaJabatan,
			&i.TmtJabatan,
			&i.NoSk,
			&i.TanggalSk,
			&i.SatuanKerja,
			&i.StatusPlt,
			&i.KelasJabatan,
			&i.PeriodeJabatanStartDate,
			&i.PeriodeJabatanEndDate,
			&i.UnitOrganisasi,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
