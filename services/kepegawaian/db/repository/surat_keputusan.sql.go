// Code generated by sqlc. DO NOT EDIT.
// source: surat_keputusan.sql

package repository

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const countSKByNIP = `-- name: CountSKByNIP :one
SELECT COUNT(1) as total
FROM file_digital_signature fds
WHERE fds.deleted_at IS NULL
    AND fds.nip_sk = $1::VARCHAR
    AND ($2::varchar IS NULL OR fds.no_sk ILIKE '%' || $2::varchar || '%')
    AND ($3::integer IS NULL OR fds.status_sk = $3::integer)
    AND ($4::varchar is null OR fds.kategori ILIKE '%' || $4::varchar || '%')
`

type CountSKByNIPParams struct {
	Nip        string      `db:"nip"`
	NoSk       pgtype.Text `db:"no_sk"`
	StatusSk   pgtype.Int4 `db:"status_sk"`
	KategoriSk pgtype.Text `db:"kategori_sk"`
}

func (q *Queries) CountSKByNIP(ctx context.Context, arg CountSKByNIPParams) (int64, error) {
	row := q.db.QueryRow(ctx, countSKByNIP,
		arg.Nip,
		arg.NoSk,
		arg.StatusSk,
		arg.KategoriSk,
	)
	var total int64
	err := row.Scan(&total)
	return total, err
}

const getBerkasSKByNIPAndID = `-- name: GetBerkasSKByNIPAndID :one
SELECT 
    file_base64
FROM 
    file_digital_signature fds
WHERE 
    fds.deleted_at IS NULL
    AND fds.nip_sk = $1::VARCHAR
    AND fds.file_id = $2::varchar
`

type GetBerkasSKByNIPAndIDParams struct {
	Nip string `db:"nip"`
	ID  string `db:"id"`
}

func (q *Queries) GetBerkasSKByNIPAndID(ctx context.Context, arg GetBerkasSKByNIPAndIDParams) (pgtype.Text, error) {
	row := q.db.QueryRow(ctx, getBerkasSKByNIPAndID, arg.Nip, arg.ID)
	var file_base64 pgtype.Text
	err := row.Scan(&file_base64)
	return file_base64, err
}

const getBerkasSKSignedByNIPAndID = `-- name: GetBerkasSKSignedByNIPAndID :one
SELECT 
    file_base64_sign
FROM 
    file_digital_signature fds
WHERE 
    fds.deleted_at IS NULL
    AND fds.nip_sk = $1::VARCHAR
    AND fds.file_id = $2::varchar
`

type GetBerkasSKSignedByNIPAndIDParams struct {
	Nip string `db:"nip"`
	ID  string `db:"id"`
}

func (q *Queries) GetBerkasSKSignedByNIPAndID(ctx context.Context, arg GetBerkasSKSignedByNIPAndIDParams) (pgtype.Text, error) {
	row := q.db.QueryRow(ctx, getBerkasSKSignedByNIPAndID, arg.Nip, arg.ID)
	var file_base64_sign pgtype.Text
	err := row.Scan(&file_base64_sign)
	return file_base64_sign, err
}

const getSKByNIPAndID = `-- name: GetSKByNIPAndID :one
SELECT
    fds.kategori as kategori_sk,
    fds.no_sk,
    fds.tanggal_sk,
    fds.status_sk,
    p.nama as nama_pemilik_sk,
    pemroses.nama as nama_penandatangan
FROM file_digital_signature fds
JOIN pegawai p on p.nip_baru = fds.nip_sk  and p.deleted_at is null
LEFT JOIN pegawai pemroses on pemroses.nip_baru = fds.nip_pemroses and pemroses.deleted_at is null
WHERE fds.deleted_at IS NULL
    AND fds.nip_sk = $1::VARCHAR
    AND fds.file_id = $2::varchar
`

type GetSKByNIPAndIDParams struct {
	Nip string `db:"nip"`
	ID  string `db:"id"`
}

type GetSKByNIPAndIDRow struct {
	KategoriSk        pgtype.Text `db:"kategori_sk"`
	NoSk              pgtype.Text `db:"no_sk"`
	TanggalSk         pgtype.Date `db:"tanggal_sk"`
	StatusSk          pgtype.Int2 `db:"status_sk"`
	NamaPemilikSk     pgtype.Text `db:"nama_pemilik_sk"`
	NamaPenandatangan pgtype.Text `db:"nama_penandatangan"`
}

func (q *Queries) GetSKByNIPAndID(ctx context.Context, arg GetSKByNIPAndIDParams) (GetSKByNIPAndIDRow, error) {
	row := q.db.QueryRow(ctx, getSKByNIPAndID, arg.Nip, arg.ID)
	var i GetSKByNIPAndIDRow
	err := row.Scan(
		&i.KategoriSk,
		&i.NoSk,
		&i.TanggalSk,
		&i.StatusSk,
		&i.NamaPemilikSk,
		&i.NamaPenandatangan,
	)
	return i, err
}

const listSKByNIP = `-- name: ListSKByNIP :many
SELECT
    fds.file_id,
    fds.kategori as kategori_sk,
    fds.no_sk,
    fds.tanggal_sk,
    fds.status_sk
FROM file_digital_signature fds
WHERE fds.deleted_at IS NULL
    AND fds.nip_sk = $3::varchar
    AND ($4::varchar IS NULL OR fds.no_sk ILIKE '%' || $4::varchar || '%')
    AND ($5::integer IS NULL OR fds.status_sk = $5::integer)
    AND ($6::varchar is null OR fds.kategori ILIKE '%' || $6::varchar || '%')
ORDER BY fds.created_at DESC
LIMIT $1 OFFSET $2
`

type ListSKByNIPParams struct {
	Limit      int32       `db:"limit"`
	Offset     int32       `db:"offset"`
	Nip        string      `db:"nip"`
	NoSk       pgtype.Text `db:"no_sk"`
	StatusSk   pgtype.Int4 `db:"status_sk"`
	KategoriSk pgtype.Text `db:"kategori_sk"`
}

type ListSKByNIPRow struct {
	FileID     string      `db:"file_id"`
	KategoriSk pgtype.Text `db:"kategori_sk"`
	NoSk       pgtype.Text `db:"no_sk"`
	TanggalSk  pgtype.Date `db:"tanggal_sk"`
	StatusSk   pgtype.Int2 `db:"status_sk"`
}

func (q *Queries) ListSKByNIP(ctx context.Context, arg ListSKByNIPParams) ([]ListSKByNIPRow, error) {
	rows, err := q.db.Query(ctx, listSKByNIP,
		arg.Limit,
		arg.Offset,
		arg.Nip,
		arg.NoSk,
		arg.StatusSk,
		arg.KategoriSk,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListSKByNIPRow
	for rows.Next() {
		var i ListSKByNIPRow
		if err := rows.Scan(
			&i.FileID,
			&i.KategoriSk,
			&i.NoSk,
			&i.TanggalSk,
			&i.StatusSk,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
